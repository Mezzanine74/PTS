<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html manifest="default.manifest">

<head>
	<title>Dark Crimson Blog - Local Database Demo</title>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	 <meta name="apple-mobile-web-app-capable" content="yes" />
	 <meta name="apple-mobile-web-app-status-bar-style" content="black" />
	 <meta name="viewport" id="viewport" content="width=device-width, initial-scale=0.5, maximum-scale=0.6, user-scalable=0">

    <link rel="stylesheet" href="db_demo.css" type="text/css">

    <style type="text/css">

/*
Main CSS for tutorial: "Getting Started with HTML5 Local Databases"
Written by Ben Lister (darkcrimson.com) revised 28 May 2010
Tutorial: http://blog.darkcrimson.com/2010/05/local-databases/

Licensed under the MIT License:
http://www.opensource.org/licenses/mit-license.php
*/



/* Global reset */
html, body, div, span, h1, h2, h3, h4, h5, h6, p, blockquote, pre, a, cite, code, em, img, strong, sub, sup, dl, dt, dd, ol, ul, li, fieldset, form, label, legend, caption { margin: 0; padding: 0; border: 0; outline: 0; font-weight: inherit; font-style: inherit; font-size: 100%; font-family: inherit; vertical-align: baseline; }
body { line-height: 1em;  font-family: Helvetica, Arial,  sans-serif; font-size: 62.5%; }	
ol, ul { list-style: none }

a { color: #000; text-decoration: none; border-bottom: 1px dotted rgba(0,0,0,0.3); }

body { font-size: 1em;}

strong { font-weight: bold }
em { font-style: italic }



/* Demo Styles */

h1 { 
	font-size: 2.3em; 
	margin: 10px 0; 
	line-height:1em;
	color: #5e5e5e;
	font-weight: bold;
	line-height: 30px;
	text-shadow:1px 1px 1px rgba(255, 255, 255, 0.2), -1px -1px 1px rgba(0, 0, 0, 0.9)
}

h3#greeting {
	color: #000;
	font-size: 1.2em;
	margin: 40px 0 20px 0;
	font-style: italic;
	font-weight: bold;
	text-shadow: 1px 1px 1px rgba(207,207,207,0.);
	text-align: left;
}
h4#your_car {
	padding: 10px;
	background: rgba(0,0,0,0.4);
	-webkit-border-bottom-left-radius: 10px;
	-webkit-border-bottom-right-radius: 10px;
	
	border-bottom-left-radius: 10px;
	border-bottom-right-radius: 10px;
	
	color: #fff;
	text-shadow: 1px 1px 1px #000;
	
}

#wrapper {
	width: 550px;
	margin: 50px auto;
	text-align: center;
}

	#wrapper table { margin: 0 auto; }
		#wrapper form { margin-bottom: 30px}
		#wrapper table tr td { height: 30px; vertical-align: top }
	
		#wrapper fieldset { 
			border: 1px dotted #000; 
			-webkit-border-radius: 10px;
			border-radius: 10px;
			width: 90%;
			margin: 0 auto;
		}
	
	#wrapper form legend {
		font-size: 1.3em;
		padding: 20px 0;
	}
	#wrapper form input#fname { 
		width: 200px;
		font-size: 1.2em;
		border: 1px solid #000;
	}
	
	#wrapper #update { margin-top:  20px}
	#wrapper label { font-size: 1.1em; text-align: right; margin-right: 10px;}	
	#wrapper select { width: 200px; }
	#wrapper table tr td { vertical-align: top; }
		
		#wrapper table tr td:nth-child(odd) { text-align: right }
		#wrapper table tr td:last-child { text-align: center }
		
	
	p#instructions {
		margin: 30px auto;
		width: 90%;
		line-height: 1.5em;
		text-align: justify;
	}
	

/* Bottom Footer*/
#footer {
	clear: both;
	padding: 20px 10px;
	background: rgba(0,0,0,0.9);
	height: 90px;
	color: #fff;
	text-shadow:2px 1px 1px rgba(223, 223, 223, 0.4);
	font-size: 0.8em;
	letter-spacing: 0.02em;
	min-width:550px;
	overflow: hidden;
}		
	#footer a {
		color: #EFEFEF;
		text-decoration: none;
		border-bottom: 1px dotted rgba(223, 223, 223, 0.2);
	}
		#footer a:hover { color: #f26d02 }
	#footer div {
		width: 550px;
		margin: 5px auto;
		text-align: center;
	}
	#footer div p { width: 90% }	
	
	#footer div p:last-child { margin-top: 10px }
	

    </style>


</head>

<body>
<div id="wrapper">
<h1>Local Database Demo</h1>

<h3 id="greeting"></h3>
		<form>
			<fieldset>
			<legend>Customize Your Experience</legend>
			
			<table>
				<tr>
					<td>
						<label for="fname">Your Name:</label>
					</td>
					<td>	
						<input type="fname" id="fname" /> 
					</td>
				</tr>
				<tr>
					<td>
						<label for="bg_color">Background:</label>
					</td>
					<td>	
						<select id="bg_color">
						
  							<option value="#B3B4EF">Periwinkle</option>
  							<option value="#DFB90D">Gold</option>
  							<option value="#B2BEB5">Ash</option>
  							<option value="#74BF3B">Green Apple</option>
						</select>
					</td>
				</tr>
				<tr>
					<td>
						<label for="font_selection">Favorite Font:</label>
					</td>
					<td>	
						<select id="font_selection">
							<option value="Helvetica">Helvetica</option>
							<option value="Georgia">Georgia</option>
							<option value="Times">Times</option>
							<option value="Lucida Sans">Lucidia Sans</option>
						</select>
					</td>
				</tr>
				<tr>
					<td>
						<label for="fav_car">Favorite Car:</label>
					</td>
					<td>	
						<select id="fav_car">
  							<option value="Porsche 911 Turbo">Porsche 911 GT3</option>
  							<option value="Audi R8 V10">Audi R8 V10</option>
  							<option value="BMW M3 CSL">BMW M3 CSL</option>
  							<option value="Broke-Ass Huffy">Broke-Ass Huffy</option>
						</select>	
					</td>
				</tr>
				
				<tr>
					<td colspan="2">
						<input type="button" id="update" value="Update Your Preferences" />
					</td>
				</tr>
			</table>

	

		<br/>

		
	<div id="content">

	</div>

		</fieldset>
		</form>
		
		
		<a href="javascript:void(0)" id="clear">→ Clear Preferences ←</a>
		
		<p id="instructions">When your prefereces are updated they are stored in a local database. The data is stored until either use the "clear preferences" or manually remove it and is only accesable within the scope of this page. You can manually view the data / databse by clicking <em>Develop > Show Web Inspector > Databases tab</em>.</p>
</div>

<div id="footer">
	<div>
		<p>
		Written by: <a href="http://darkcrimson.com" target="_blank">Ben Lister</a> for tutorial: <a href="http://blog.darkcrimson.com/2010/05/local-databases/" target="_blank">&#147;Getting Started with HTML5 Local Databases&#148;</a>. Last revised: 2010 May 12
		</p>
	<br />
<p>This page and its related files are <a href="http://www.opensource.org/licenses/mit-license.php" target="_blank">Licensed under the MIT License</a></p>	

	<p><a href="http://twitter.com/benclister" target="_blank">Follow me on Twitter</a> | <a href="http://blog.darkcrimson.com/samples/localdb/darkcrimson_localdb_demo.zip">Download Source</a>
		</p>	
	</div>
</div>

<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-818084-5");
pageTracker._trackPageview();
} catch(err) {}</script>

<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>

    <script type="text/javascript">

        /*
        Main JS for tutorial: "Getting Started with HTML5 Local Databases"
        Written by Ben Lister (darkcrimson.com) revised May 12, 2010
        Tutorial: http://blog.darkcrimson.com/2010/05/local-databases/
        
        Licensed under the MIT License:
        http://www.opensource.org/licenses/mit-license.php
        */

        $(function () {

            var localDBDemo = {
                init: function () {

                    this.initDatabase();

                    // Button and link actions
                    $('#clear').on('click', function () {
                        localDBDemo.dropTables();
                    });

                    $('#update').on('click', function () {
                        localDBDemo.updateSetting();
                    });

                },

                initDatabase: function () {
                    try {
                        if (!window.openDatabase) {
                            alert('Local Databases are not supported by your browser. Please use a Webkit browser for this demo');
                        } else {
                            var shortName = 'DEMODB',
                                version = '1.0',
                                displayName = 'DEMODB Test',
                                maxSize = 100000; // in bytes

                            DEMODB = openDatabase(shortName, version, displayName, maxSize);
                            this.createTables();
                            this.selectAll();
                        }
                    } catch (e) {
                        if (e === 2) {
                            // Version mismatch.
                            console.log("Invalid database version.");
                        } else {
                            console.log("Unknown error " + e + ".");
                        }
                        return;
                    }
                },

                /***
                **** CREATE TABLE ** 
                ***/
                createTables: function () {
                    var that = this;
                    DEMODB.transaction(
                        function (transaction) {
                            transaction.executeSql('CREATE TABLE IF NOT EXISTS page_settings(id INTEGER NOT NULL PRIMARY KEY, fname TEXT NOT NULL,bgcolor TEXT NOT NULL, font TEXT, favcar TEXT);', [], that.nullDataHandler, that.errorHandler);
                        }
                    );
                    this.prePopulate();
                },

                /***
                **** INSERT INTO TABLE ** 
                ***/
                prePopulate: function () {
                    DEMODB.transaction(
                        function (transaction) {
                            //Starter data when page is initialized
                            var data = ['1', 'none', '#B3B4EF', 'Helvetica', 'Porsche 911 GT3'];

                            transaction.executeSql("INSERT INTO page_settings(id, fname, bgcolor, font, favcar) VALUES (?, ?, ?, ?, ?)", [data[0], data[1], data[2], data[3], data[4]]);
                        }
                    );
                },

                /***
                **** UPDATE TABLE ** 
                ***/
                updateSetting: function () {
                    DEMODB.transaction(
                        function (transaction) {
                            var fname,
                            bg = $('#bg_color').val(),
                            font = $('#font_selection').val(),
                            car = $('#fav_car').val();

                            if ($('#fname').val() != '') {
                                fname = $('#fname').val();
                            } else {
                                fname = 'none';
                            }

                            transaction.executeSql("UPDATE page_settings SET fname=?, bgcolor=?, font=?, favcar=? WHERE id = 1", [fname, bg, font, car]);
                        }
                    );

                    this.selectAll();
                },

                selectAll: function () {
                    var that = this;
                    DEMODB.transaction(
                        function (transaction) {
                            transaction.executeSql("SELECT * FROM page_settings;", [], that.dataSelectHandler, that.errorHandler);

                        }
                    );
                },

                dataSelectHandler: function (transaction, results) {
                    // Handle the results
                    var i = 0,
                        row;

                    for (i ; i < results.rows.length; i++) {

                        row = results.rows.item(i);

                        $('body').css('background-color', row['bgcolor']);
                        $('body').css('font-family', row['font']);
                        $('#content').html('<h4 id="your_car">Your Favorite Car is a ' + row['favcar'] + '</h4>');

                        if (row['fname'] != 'none') {
                            $('#greeting').html('Howdy-ho, ' + row['fname'] + '!');
                            $('#fname').val(row['fname']);
                        }

                        $('select#font_selection').find('option[value="' + row['font'] + '"]').attr('selected', 'selected');
                        $('select#bg_color').find('option[value="' + row['bgcolor'] + '"]').attr('selected', 'selected');
                        $('select#fav_car').find('option[value="' + row['favcar'] + '"]').attr('selected', 'selected');

                    }
                },

                /***
                **** Save 'default' data into DB table **
                ***/
                saveAll: function () {
                    this.prePopulate(1);
                },

                errorHandler: function (transaction, error) {

                    if (error.code === 1) {
                        // DB Table already exists
                    } else {
                        // Error is a human-readable string.
                        console.log('Oops.  Error was ' + error.message + ' (Code ' + error.code + ')');
                    }
                    return false;
                },

                nullDataHandler: function () {
                    console.log("SQL Query Succeeded");
                },

                /***
                **** SELECT DATA **
                ***/
                selectAll: function () {
                    var that = this;
                    DEMODB.transaction(
                        function (transaction) {
                            transaction.executeSql("SELECT * FROM page_settings;", [], that.dataSelectHandler, that.errorHandler);
                        }
                    );
                },

                /***
                **** DELETE DB TABLE ** 
                ***/
                dropTables: function () {
                    var that = this;
                    DEMODB.transaction(
                        function (transaction) {
                            transaction.executeSql("DROP TABLE page_settings;", [], that.nullDataHandler, that.errorHandler);
                        }
                    );
                    console.log("Table 'page_settings' has been dropped.");
                    //location.reload();			
                }


            };


            //Instantiate Demo
            localDBDemo.init();

        });

    </script>

</body>
</html>